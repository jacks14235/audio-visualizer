import numpy as np
import sys
import time

characters = {
  'a': [
    [1,1,1],
    [1,0,1],
    [1,1,1],
    [1,0,1],
    [1,0,1],
  ],
  'b': [
    [1,1,0],
    [1,0,1],
    [1,1,1],
    [1,0,1],
    [1,1,1],
  ],
  'c': [
    [1,1,1],
    [1,0,0],
    [1,0,0],
    [1,0,0],
    [1,1,1],
  ],
  'd': [
    [1,1,0],
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [1,1,0],
  ],
  'e': [
    [1,1,1],
    [1,0,0],
    [1,1,1],
    [1,0,0],
    [1,1,1],
  ],
  'f': [
    [1,1,1],
    [1,0,0],
    [1,1,1],
    [1,0,0],
    [1,0,0],
  ],
  'g': [
    [1,1,1],
    [1,0,0],
    [1,0,1],
    [1,0,1],
    [1,1,1],
  ],
  'h': [
    [1,0,1],
    [1,0,1],
    [1,1,1],
    [1,0,1],
    [1,0,1],
  ],
  'i': [
    [1,1,1],
    [0,1,0],
    [0,1,0],
    [0,1,0],
    [1,1,1],
  ],
  'j': [
    [0,0,1],
    [0,0,1],
    [0,0,1],
    [1,0,1],
    [0,1,0],
  ],
  'k': [
    [1,0,1],
    [1,0,1],
    [1,1,0],
    [1,0,1],
    [1,0,1],
  ],
  'l': [
    [1,0,0],
    [1,0,0],
    [1,0,0],
    [1,0,0],
    [1,1,1],
  ],
  'm': [
    [1,0,1],
    [1,1,1],
    [1,1,1],
    [1,0,1],
    [1,0,1],
  ],
  'n': [
    [1,1,0],
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [1,0,1],
  ],
  'o': [
    [1,1,1],
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [1,1,1],
  ],
  'p': [
    [1,1,1],
    [1,0,1],
    [1,1,1],
    [1,0,0],
    [1,0,0],
  ],
  'q': [
    [1,1,1],
    [1,0,1],
    [1,0,1],
    [1,1,1],
    [0,0,1],
  ],
  'r': [
    [1,1,0],
    [1,0,1],
    [1,1,0],
    [1,0,1],
    [1,0,1],
  ],
  's': [
    [1,1,1],
    [1,0,0],
    [1,1,1],
    [0,0,1],
    [1,1,1],
  ],
  't': [
    [1,1,1],
    [0,1,0],
    [0,1,0],
    [0,1,0],
    [0,1,0],
  ],
  'u': [
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [1,1,1],
  ],
  'v': [
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [1,0,1],
    [0,1,0],
  ],
  'w': [
    [1,0,1],
    [1,0,1],
    [1,1,1],
    [1,1,1],
    [1,0,1],
  ],
  'x': [
    [1,0,1],
    [1,0,1],
    [0,1,0],
    [1,0,1],
    [1,0,1],
  ],
  'y': [
    [1,0,1],
    [1,0,1],
    [1,1,1],
    [0,0,1],
    [1,1,0],
  ],
  'z': [
    [1,1,1],
    [0,0,1],
    [0,1,0],
    [1,0,0],
    [1,1,1],
  ],
  '|': [
    [1, 0, 0],
    [1, 0, 0],
    [1, 0, 0],
    [1, 0, 0],
    [1, 0, 0],
  ],
  '[': [
    [2, 0, 0],
    [2, 0, 0],
    [2, 0, 0],
    [2, 0, 0],
    [2, 0, 0],
  ],
  ']': [
    [3, 0, 0],
    [3, 0, 0],
    [3, 0, 0],
    [3, 0, 0],
    [3, 0, 0],
  ],
  '0': [
    [1, 1, 1],
    [1, 0, 1],
    [1, 0, 1],
    [1, 0, 1],
    [1, 1, 1],
  ],
  '1': [
    [1, 1, 0],
    [0, 1, 0],
    [0, 1, 0],
    [0, 1, 0],
    [1, 1, 1],
  ],
  '2': [
    [1, 1, 1],
    [0, 0, 1],
    [1, 1, 1],
    [1, 0, 0],
    [1, 1, 1],
  ],
  '3': [
    [1, 1, 1],
    [0, 0, 1],
    [1, 1, 1],
    [0, 0, 1],
    [1, 1, 1],
  ],
  '4': [
    [1, 0, 1],
    [1, 0, 1],
    [1, 1, 1],
    [0, 0, 1],
    [0, 0, 1],
  ],
  '5': [
    [1, 1, 1],
    [1, 0, 0],
    [1, 1, 1],
    [0, 0, 1],
    [1, 1, 1],
  ],
  '6': [
    [1, 1, 1],
    [1, 0, 0],
    [1, 1, 1],
    [1, 0, 1],
    [1, 1, 1],
  ],
  '7': [
    [1, 1, 1],
    [0, 0, 1],
    [0, 0, 1],
    [0, 0, 1],
    [0, 0, 1],
  ],
  '8': [
    [1, 1, 1],
    [1, 0, 1],
    [1, 1, 1],
    [1, 0, 1],
    [1, 1, 1],
  ],
  '9': [
    [1, 1, 1],
    [1, 0, 1],
    [1, 1, 1],
    [0, 0, 1],
    [0, 0, 1],
  ],
  ' ': [
    [0, 0, 0],
    [0, 0, 0],
    [0, 0, 0],
    [0, 0, 0],
    [0, 0, 0],
  ],
  '-': [
    [0, 0, 0],
    [0, 0, 0],
    [1, 1, 1],
    [0, 0, 0],
    [0, 0, 0],
  ],
  '!': [
    [0, 1, 0],
    [0, 1, 0],
    [0, 1, 0],
    [0, 0, 0],
    [0, 1, 0],
  ],
  '+': [
    [0, 0, 0],
    [0, 1, 0],
    [1, 1, 1],
    [0, 1, 0],
    [0, 0, 0],
  ],
  '>': [
    [1, 0, 1],
    [1, 1, 1],
    [1, 1, 1],
    [1, 1, 1],
    [0, 1, 0],
  ],
  '?': [
    [1, 1, 1],
    [0, 0, 1],
    [0, 1, 1],
    [0, 1, 0],
    [0, 1, 0],
  ],
}

LETTER_SPACE = 1
SCROLL_FRAMES = 6
END_SPACE = 4
COLOR = np.array([255, 255, 255])

def text(data, resolution, words):
  # print(words)
  # words = 'abcdefghijklmnopqrstuvwxyz'
  words += ' ' * END_SPACE
  to_add = resolution[0] - len(words) * (3 + LETTER_SPACE)
  if to_add > 1:
    words += ' ' * (to_add // (3 + LETTER_SPACE) + 1)

  unknown = characters['?']
  pixels = np.array([characters.get(i, unknown) for i in words])

  # add letter spaces
  pixels = np.pad(pixels, ((0,0),(0,0),(0, LETTER_SPACE)))

  # reshape to (5, -1)
  pixels = pixels.transpose(1,0,2).reshape(5,-1)

  # add third dimension for color
  pixels = np.repeat(pixels[:,:,np.newaxis], 3, axis=2)
  pixels = pixels * COLOR
  # print(pixels, file=sys.stderr)
  # print(pixels.shape, file=sys.stderr)
  data[:,:,:] = 0
  pixels = pixels.transpose(1,0,2)

  t = 0
  while True:
    start = t // SCROLL_FRAMES
    end = start + resolution[0]
    data[:, 0:5] = pixels.take(range(start, end), mode='wrap', axis=0)
    t+=1
    time.sleep(.016)


  



if __name__ == '__main__':
  text([], '14235')


def text_mask(data, _):
  data[:] = np.zeros(data.shape)
  data[:, 0:5] = [1, 1, 1]